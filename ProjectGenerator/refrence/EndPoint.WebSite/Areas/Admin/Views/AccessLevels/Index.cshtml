@model AccessLevelListViewModel
@{
    ViewData["Title"] = "سطح دسترسی لیست";
    ViewData["Subtitle"] = "تعریف نقش‌ها، مدیریت دسترسی‌ها و انتساب آسان به کاربران";

    var roles = Model.Roles?.ToList() ?? new System.Collections.Generic.List<AccessLevelCardViewModel>();
    var permissionGroups = Model.PermissionGroups?.ToList() ?? new System.Collections.Generic.List<PermissionGroupDefinitionViewModel>();
}

@section Head {
    <link rel="stylesheet" href="~/css/admin/access-levels.css" asp-append-version="true" />
}

@section Breadcrumb {
    <li class="breadcrumb-item"><a asp-area="Admin" asp-controller="Dashboard" asp-action="Index">داشبورد</a></li>
    <li class="breadcrumb-item active" aria-current="page">@ViewData["Title"]</li>
}

@await Html.PartialAsync("_StatusMessage")

<div class="access-levels-page">
    <div class="access-levels-page__actions access-levels-page__actions--standalone">
        <a class="btn btn-outline-primary"
           asp-area="Admin"
           asp-controller="Users"
           asp-action="Index">
            <i class="bi bi-people me-1"></i>
            مدیریت کاربران
        </a>
        <button type="button"
                class="btn btn-primary"
                data-access-level-modal-trigger
                data-modal-url="@Url.Action("Create")">
            <i class="bi bi-plus-lg me-1"></i>
            افزودن نقش جدید
        </button>
    </div>

    <div class="row g-4 access-levels-grid">
        @if (roles.Count == 0)
        {
            <div class="col-12">
                <div class="access-levels-empty">
                    هنوز نقشی ثبت نشده است. با دکمه «افزودن نقش جدید» اولین سطح دسترسی را ایجاد کنید.
                </div>
            </div>
        }
        else
        {
            foreach (var role in roles)
            {
                <div class="col-12 col-lg-4">
                    <div class="access-card">
                        <div class="access-card__header">
                            <div>
                                <h3 class="access-card__title">@role.DisplayName</h3>
                                <span class="access-card__meta">@role.UserCount کاربر دارای این نقش</span>
                            </div>
                            <button type="button"
                                    class="btn btn-light btn-sm"
                                    data-access-level-modal-trigger
                                    data-modal-url="@Url.Action("Edit", new { id = role.Id })">
                                <i class="bi bi-pencil"></i>
                                ویرایش
                            </button>
                        </div>
                        <div class="access-card__body">
                            <div class="access-card__label">دسترسی‌های نقش</div>
                            @if (role.Permissions.Count == 0)
                            {
                                <div class="text-muted small">برای این نقش سطح دسترسی تعیین نشده است.</div>
                            }
                            else
                            {
                                <ul class="access-card__permissions">
                                    @foreach (var permission in role.Permissions)
                                    {
                                        <li>
                                            <i class="bi bi-check-circle-fill"></i>
                                            <span>@permission.DisplayName</span>
                                        </li>
                                    }
                                </ul>
                            }
                        </div>
                        <div class="access-card__footer">
                            <a class="btn btn-soft-primary"
                               asp-area="Admin"
                               asp-controller="Users"
                               asp-action="Index"
                               asp-route-role="@role.Name">
                                <i class="bi bi-arrow-up-right-square"></i>
                                کاربران این نقش
                            </a>
                            <button type="button"
                                    class="btn btn-light"
                                    data-access-level-modal-trigger
                                    data-modal-url="@Url.Action("Edit", new { id = role.Id })">
                                <i class="bi bi-sliders"></i>
                                به‌روزرسانی دسترسی
                            </button>
                        </div>
                    </div>
                </div>
            }
        }
    </div>

    <div class="access-permission-legend card">
        <div class="card-body">
            <h4 class="access-permission-legend__title">راهنمای دسته‌بندی دسترسی‌ها</h4>
            <div class="row g-4">
                @foreach (var group in permissionGroups)
                {
                    <div class="col-12 col-md-6 col-xl-4">
                        <div class="permission-group">
                            <div class="permission-group__title">@group.DisplayName</div>
                            <ul class="permission-group__list">
                                @foreach (var permission in group.Permissions)
                                {
                                    <li>
                                        <span class="permission-group__name">@permission.DisplayName</span>
                                        @if (permission.IsCustom)
                                        {
                                            <span class="badge badge-solid badge-solid--primary ms-2">سفارشی</span>
                                        }
                                        @if (permission.IsCore)
                                        {
                                            <span class="badge badge-solid badge-solid--warning ms-2">Core</span>
                                        }
                                        @if (!string.IsNullOrWhiteSpace(permission.Description))
                                        {
                                            <span class="permission-group__hint">@permission.Description</span>
                                        }
                                    </li>
                                }
                            </ul>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="accessLevelModal" tabindex="-1" aria-hidden="true" data-access-level-modal></div>

@section Scripts {
    <script src="~/js/admin/access-levels.js" asp-append-version="true"></script>
}
