@model ProductDetailViewModel
@{
    ViewData["ContainerClass"] = "container product-detail-container";
    ViewData["MainClass"] = "site-main product-detail-main";
    var commentSuccess = TempData["ProductCommentSuccess"] as bool?;
    var requestPath = Context?.Request?.Path.Value ?? Url.Action("Index", "Home") ?? "/";
    var requestQuery = Context?.Request?.QueryString.Value;
    var currentReturnUrl = string.IsNullOrEmpty(requestQuery) ? requestPath : $"{requestPath}{requestQuery}";
    var quantityInputId = $"product-quantity-{Model.Product.Id:N}";
}
@section Styles {
    <link rel="stylesheet" href="~/css/product-detail-modern.css" asp-append-version="true" />
}

<section class="product-hero" aria-labelledby="productTitle" style="background-image: url('@Model.HeroImageUrl');">
    <div class="product-hero__overlay"></div>
    <div class="product-hero__content">
        <div class="product-hero__info">
            <span class="product-hero__category">@Model.Product.Category</span>
            <h1 class="product-hero__title" id="productTitle">@Model.Product.Name</h1>
            <p class="product-hero__description">@Html.Raw(Model.Description)</p>
            <div class="product-hero__meta">
                <div class="product-hero__rating" aria-label="@Model.Product.GetReviewCountLabel()">
                    <span class="product-hero__rating-icon" aria-hidden="true">â˜…</span>
                    <span>@Model.Product.GetRatingLabel()</span>
                    <span class="product-hero__dot" aria-hidden="true">â€¢</span>
                    <span>@Model.Product.GetReviewCountLabel()</span>
                </div>
                @if (!string.IsNullOrWhiteSpace(Model.Duration))
                {
                    <span class="product-hero__dot" aria-hidden="true">â€¢</span>
                    <span class="product-hero__duration">@Model.Duration</span>
                }
                @if (!string.IsNullOrWhiteSpace(Model.DifficultyLevel))
                {
                    <span class="product-hero__dot" aria-hidden="true">â€¢</span>
                    <span class="product-hero__difficulty">@Model.DifficultyLevel</span>
                }
            </div>
            @if (Model.Product.Tags.Any())
            {
                <div class="product-hero__tags" aria-label="Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§ÛŒ Ù…Ø­ØµÙˆÙ„">
                    @foreach (var tag in Model.Product.Tags.Take(4))
                    {
                        <span class="product-hero__tag">@tag</span>
                    }
                </div>
            }
        </div>
        <div class="product-hero__pricing" aria-labelledby="productPriceTitle">
            <h2 class="product-hero__pricing-title" id="productPriceTitle">Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ</h2>
            <div class="product-hero__price">
                <span class="product-hero__price-current">@Model.Product.GetFormattedPrice() ØªÙˆÙ…Ø§Ù†</span>
                @if (Model.Product.OriginalPrice.HasValue)
                {
                    <span class="product-hero__price-original">@Model.Product.GetFormattedOriginalPrice() ØªÙˆÙ…Ø§Ù†</span>
                }
            </div>
            <ul class="product-hero__benefits" aria-label="ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒ">
                @foreach (var highlight in Model.Highlights)
                {
                    <li>@highlight</li>
                }
            </ul>
            <div class="product-hero__actions" aria-label="Ø§Ù‚Ø¯Ø§Ù…Ø§Øª Ø®Ø±ÛŒØ¯">
                <form asp-controller="Cart" asp-action="Add" method="post" class="product-hero__cart-form">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="productId" value="@Model.Product.Id" />
                    <input type="hidden" name="returnUrl" value="@currentReturnUrl" />
                    <div class="product-hero__quantity">
                        <label class="product-hero__quantity-label" for="@quantityInputId">ØªØ¹Ø¯Ø§Ø¯</label>
                        <div class="product-hero__quantity-input">
                            <button type="button" class="product-hero__quantity-button" aria-label="Ú©Ø§Ù‡Ø´ ØªØ¹Ø¯Ø§Ø¯" onclick="const input=this.parentElement.querySelector('input'); if(input && input.value){ const value=parseInt(input.value,10)||1; if(value>1){ input.stepDown(); input.dispatchEvent(new Event('change')); }}">âˆ’</button>
                            <input id="@quantityInputId" name="quantity" type="number" min="1" value="1" inputmode="numeric" pattern="[0-9]*" />
                            <button type="button" class="product-hero__quantity-button" aria-label="Ø§ÙØ²Ø§ÛŒØ´ ØªØ¹Ø¯Ø§Ø¯" onclick="const input=this.parentElement.querySelector('input'); if(input){ input.stepUp(); input.dispatchEvent(new Event('change')); }}">+</button>
                        </div>
                    </div>
                    <button type="submit" class="product-hero__cart-button">
                        <span class="product-hero__cart-icon" aria-hidden="true">ğŸ›’</span>
                        <span>Ø§ÙØ²ÙˆØ¯Ù† Ø¨Ù‡ Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯</span>
                    </button>
                    <p class="product-hero__cart-hint">Ù¾Ø±Ø¯Ø§Ø®Øª Ø§Ù…Ù† Ùˆ Ø¯Ø±ÛŒØ§ÙØª ÙÙˆØ±ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ù¾Ø³ Ø§Ø² ØªÚ©Ù…ÛŒÙ„ Ø®Ø±ÛŒØ¯.</p>
                </form>
                <a class="product-hero__cta" asp-controller="Account" asp-action="PhoneLogin">Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù…Ø´Ø§ÙˆØ±Ù‡ Ø±Ø§ÛŒÚ¯Ø§Ù†</a>
            </div>
            <p class="product-hero__note">Ù¾Ø³ Ø§Ø² Ø«Ø¨Øª Ø¯Ø±Ø®ÙˆØ§Ø³ØªØŒ Ù…Ø´Ø§ÙˆØ± ØªØ®ØµØµÛŒ Ø¢Ø±Ø³ÛŒØ³ Ø·ÛŒ Û²Û´ Ø³Ø§Ø¹Øª Ø¨Ø§ Ø´Ù…Ø§ ØªÙ…Ø§Ø³ Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯.</p>
        </div>
    </div>
</section>

<section class="product-section" aria-labelledby="modulesTitle">
    <div class="product-section__header">
        <h2 class="product-section__title" id="modulesTitle">Ø³Ø§Ø®ØªØ§Ø± Ø¨Ø±Ù†Ø§Ù…Ù‡</h2>
        <p class="product-section__subtitle">Ú¯Ø§Ù…â€ŒÙ‡Ø§ÛŒ Ø§Ø¬Ø±Ø§ÛŒÛŒ Ù…Ø­ØµÙˆÙ„ Ùˆ Ù…Ø­ØªÙˆØ§ÛŒ Ù‡Ø± Ù…Ø±Ø­Ù„Ù‡</p>
    </div>
    <div class="product-modules">
        @foreach (var module in Model.Modules)
        {
            <article class="product-module">
                <h3 class="product-module__title">@module.Title</h3>
                <p class="product-module__description">@module.Description</p>
                @if (!string.IsNullOrWhiteSpace(module.Duration))
                {
                    <span class="product-module__duration">@module.Duration</span>
                }
            </article>
        }
    </div>
</section>

@if (Model.Statistics.Any())
{
    <section class="product-section" aria-labelledby="statsTitle">
        <div class="product-section__header">
            <h2 class="product-section__title" id="statsTitle">Ø´Ø§Ø®Øµâ€ŒÙ‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒ</h2>
        </div>
        <div class="product-stats">
            @foreach (var stat in Model.Statistics)
            {
                <div class="product-stat" @(string.IsNullOrWhiteSpace(stat.Tooltip) ? null : $"title=\"{stat.Tooltip}\"")>
                    <span class="product-stat__value">@stat.Value</span>
                    <span class="product-stat__label">@stat.Label</span>
                </div>
            }
        </div>
    </section>
}

@if (Model.FaqItems.Any())
{
    <section class="product-section" aria-labelledby="faqTitle">
        <div class="product-section__header">
            <h2 class="product-section__title" id="faqTitle">Ø³ÙˆØ§Ù„Ø§Øª Ù…ØªØ¯Ø§ÙˆÙ„</h2>
        </div>
        <div class="product-faq">
            @foreach (var faq in Model.FaqItems)
            {
                <details class="product-faq__item">
                    <summary class="product-faq__question">@faq.Question</summary>
                    <p class="product-faq__answer">@faq.Answer</p>
                </details>
            }
        </div>
    </section>
}

<section class="product-comments blog-comments" id="comments" aria-labelledby="commentsTitle">
    <div class="blog-comments__header">
        <div>
            <h2 class="blog-comments__title" id="commentsTitle">Ù†Ø¸Ø± Ù…Ø´ØªØ±ÛŒØ§Ù†</h2>
            <p class="blog-comments__subtitle">ØªØ¬Ø±Ø¨Ù‡ Ø³Ø§Ø²Ù…Ø§Ù†â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ø§Ø² Ø§ÛŒÙ† Ù…Ø­ØµÙˆÙ„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ø±Ø¯Ù‡â€ŒØ§Ù†Ø¯</p>
        </div>
        <div class="product-comments__meta">
            <span class="product-comment__rating">
                <span class="product-comment__rating-icon" aria-hidden="true">â˜…</span>
                @Model.Product.GetRatingLabel()
            </span>
            <span class="product-comments__count">@Model.Product.GetReviewCountLabel()</span>
        </div>
    </div>

    @if (!Model.Comments.Any())
    {
        <p class="blog-comments__empty">Ù‡Ù†ÙˆØ² Ù†Ø¸Ø±ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>
    }
    else
    {
        <ol class="blog-comments__list" role="list">
            @foreach (var comment in Model.Comments)
            {
                @await Html.PartialAsync("_ProductComment", comment)
            }
        </ol>
    }

    <section class="blog-comments__form product-comments__form" aria-labelledby="commentFormTitle">
        <h3 class="blog-comments__form-title" id="commentFormTitle">Ø«Ø¨Øª Ù†Ø¸Ø± Ø¬Ø¯ÛŒØ¯</h3>
        <p class="blog-comments__form-subtitle">Ù†Ø¸Ø± Ø´Ù…Ø§ Ù¾Ø³ Ø§Ø² Ø¨Ø±Ø±Ø³ÛŒ Ùˆ ØªØ§ÛŒÛŒØ¯ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</p>
        @if (commentSuccess == true)
        {
            <div class="alert alert-success product-comments__alert" role="status">
                Ù†Ø¸Ø± Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø«Ø¨Øª Ø´Ø¯ Ùˆ Ù¾Ø³ Ø§Ø² Ø¨Ø±Ø±Ø³ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯.
            </div>
        }
        <form asp-action="AddComment" asp-route-slug="@Model.Product.Slug" method="post" class="blog-comment-form" novalidate>
            @Html.AntiForgeryToken()
            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
            <input type="hidden" asp-for="NewComment.ProductId" />
            <input type="hidden" asp-for="NewComment.ParentId" />
            <div class="blog-comment-form__row">
                <div class="blog-comment-form__field">
                    <label asp-for="NewComment.AuthorName" class="form-label"></label>
                    <input asp-for="NewComment.AuthorName" class="form-control" autocomplete="name" />
                    <span asp-validation-for="NewComment.AuthorName" class="text-danger"></span>
                </div>
                <div class="blog-comment-form__field">
                    <label asp-for="NewComment.Rating" class="form-label"></label>
                    <select asp-for="NewComment.Rating" class="form-select">
                        @for (var rating = 5.0; rating >= 0; rating -= 0.5)
                        {
                            <option value="@rating">@rating.ToString("0.0")</option>
                        }
                    </select>
                    <span asp-validation-for="NewComment.Rating" class="text-danger"></span>
                </div>
            </div>
            <div class="blog-comment-form__field">
                <label asp-for="NewComment.Content" class="form-label"></label>
                <textarea asp-for="NewComment.Content" class="form-control" rows="5"></textarea>
                <span asp-validation-for="NewComment.Content" class="text-danger"></span>
            </div>
            <button type="submit" class="blog-comment-form__submit">Ø«Ø¨Øª Ù†Ø¸Ø±</button>
        </form>
    </section>
</section>

@if (Model.RelatedProducts.Any())
{
    <section class="product-section" aria-labelledby="relatedProductsTitle">
        <div class="product-section__header">
            <h2 class="product-section__title" id="relatedProductsTitle">Ù…Ø­ØµÙˆÙ„Ø§Øª Ù…Ø±ØªØ¨Ø·</h2>
            <p class="product-section__subtitle">Ø±Ø§Ù‡Ú©Ø§Ø±Ù‡Ø§ÛŒ Ù…Ú©Ù…Ù„ Ø¨Ø±Ø§ÛŒ ØªÙˆØ³Ø¹Ù‡ Ø¹Ù…ÛŒÙ‚â€ŒØªØ±</p>
        </div>
        <div class="product-related">
            @foreach (var product in Model.RelatedProducts)
            {
                <article class="product-related__item">
                    <a class="product-related__card" asp-controller="Product" asp-action="Details" asp-route-slug="@product.Slug">
                        <div class="product-related__media" aria-hidden="true">
                            <img src="@product.ThumbnailUrl" alt="" loading="lazy" />
                        </div>
                        <div class="product-related__body">
                            <h3 class="product-related__title">@product.Name</h3>
                            <p class="product-related__excerpt">@product.ShortDescription</p>
                            <div class="product-related__price">
                                <span class="product-related__price-current">@product.GetFormattedPrice() ØªÙˆÙ…Ø§Ù†</span>
                            </div>
                        </div>
                    </a>
                </article>
            }
        </div>
    </section>
}
