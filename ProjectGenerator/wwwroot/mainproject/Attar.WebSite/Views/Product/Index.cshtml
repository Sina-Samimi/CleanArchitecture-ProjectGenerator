@model ProductListViewModel
@{
    Layout = "_HomeTemplateLayout";
    ViewData["Title"] = "Ù„ÛŒØ³Øª Ù…Ø­ØµÙˆÙ„Ø§Øª - Ø¹Ø·Ø§Ø±ÛŒ Ø¢Ù†Ù„Ø§ÛŒÙ†";
    ViewData["MetaDescription"] = "ØªÙ…Ø§Ù… Ù…Ø­ØµÙˆÙ„Ø§Øª Ú¯ÛŒØ§Ù‡Ø§Ù† Ø¯Ø§Ø±ÙˆÛŒÛŒ Ùˆ Ø·Ø¨ÛŒØ¹ÛŒ";
}

<!-- Products Archive Section -->
<section class="products-archive-section">
    <div class="container">
        <!-- Breadcrumb -->
        <div class="breadcrumb">
            <a asp-controller="Home" asp-action="Index">Ø®Ø§Ù†Ù‡</a> / 
            <span>Ù„ÛŒØ³Øª Ù…Ø­ØµÙˆÙ„Ø§Øª</span>
        </div>

        <!-- Page Header -->
        <div class="archive-header">
            <h1 class="archive-title">Ù„ÛŒØ³Øª Ù…Ø­ØµÙˆÙ„Ø§Øª</h1>
            <p class="archive-subtitle">ØªÙ…Ø§Ù… Ù…Ø­ØµÙˆÙ„Ø§Øª Ú¯ÛŒØ§Ù‡Ø§Ù† Ø¯Ø§Ø±ÙˆÛŒÛŒ Ùˆ Ø·Ø¨ÛŒØ¹ÛŒ</p>
        </div>

        <div class="archive-layout">
            <!-- Sidebar Filters -->
            <aside class="filters-sidebar">
                <form method="get" id="productFilterForm">
                    <div class="filters-card">
                        <h3 class="filters-title">ğŸ” Ø¬Ø³ØªØ¬Ùˆ</h3>
                        <div class="search-filter">
                            <input type="text" name="search" id="search-input" value="@Model.Filters.SearchTerm" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ù…Ø­ØµÙˆÙ„Ø§Øª..." class="search-input">
                            <button type="button" id="search-submit-btn" class="search-btn">ğŸ”</button>
                        </div>
                    </div>

                    <div class="filters-card">
                        <h3 class="filters-title">ğŸ“‚ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</h3>
                        <div class="filter-group">
                            <label class="filter-checkbox">
                                <input type="radio" name="category" value="" @(string.IsNullOrWhiteSpace(Model.Filters.SelectedCategory) ? "checked" : "") onchange="this.form.submit()">
                                <span>Ù‡Ù…Ù‡ Ù…Ø­ØµÙˆÙ„Ø§Øª</span>
                            </label>
                            @foreach (var category in Model.Filters.Categories)
                            {
                                <label class="filter-checkbox">
                                    <input type="radio" name="category" value="@category.Value" @(category.IsSelected ? "checked" : "") onchange="this.form.submit()">
                                    <span>@category.Label (@category.Count)</span>
                                </label>
                            }
                        </div>
                    </div>

                    <div class="filters-card">
                        <h3 class="filters-title">ğŸ’° Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ù‚ÛŒÙ…Øª</h3>
                        <div class="price-filter">
                            <div class="price-inputs" style="display:grid !important">
                                <input type="number" name="minPrice" id="minPrice" value="@(Model.Filters.MinPrice?.ToString("0"))" placeholder="Ø­Ø¯Ø§Ù‚Ù„" min="0">
                                <input type="number" name="maxPrice" id="maxPrice" value="@(Model.Filters.MaxPrice?.ToString("0"))" placeholder="Ø­Ø¯Ø§Ú©Ø«Ø±" min="0">
                            </div>
                            <button type="button" id="price-filter-btn" class="price-filter-btn">Ø§Ø¹Ù…Ø§Ù„ ÙÛŒÙ„ØªØ± Ù‚ÛŒÙ…Øª</button>
                        </div>
                    </div>

                    <div class="filters-card">
                        <h3 class="filters-title">â­ Ø§Ù…ØªÛŒØ§Ø²</h3>
                        <div class="filter-group">
                            <label class="filter-checkbox">
                                <input type="radio" name="rating" value="" @(!Model.Filters.MinRating.HasValue ? "checked" : "") onchange="this.form.submit()">
                                <span>Ù‡Ù…Ù‡</span>
                            </label>
                            @foreach (var ratingOption in Model.Filters.RatingOptions)
                            {
                                <label class="filter-checkbox">
                                    <input type="radio" name="rating" value="@ratingOption.Value" @(ratingOption.IsSelected ? "checked" : "") onchange="this.form.submit()">
                                    <span>@ratingOption.Label (@ratingOption.Count)</span>
                                </label>
                            }
                        </div>
                    </div>

                    <div class="filters-card">
                        <a asp-controller="Product" asp-action="Index" class="reset-filters-btn" style="display: block; text-align: center; text-decoration: none;">ğŸ”„ Ø¨Ø§Ø²Ù†Ø´Ø§Ù†ÛŒ ÙÛŒÙ„ØªØ±Ù‡Ø§</a>
                    </div>
                </form>
            </aside>

            <!-- Main Content -->
            <main class="archive-main">
                <!-- Sort and View Options -->
                <div class="archive-toolbar">
                    <div class="results-info">
                        <span>@Model.TotalCount.ToString("N0", new System.Globalization.CultureInfo("fa-IR")) Ù…Ø­ØµÙˆÙ„ ÛŒØ§ÙØª Ø´Ø¯</span>
                    </div>
                    <div class="sort-options">
                        <label>Ù…Ø±ØªØ¨â€ŒØ³Ø§Ø²ÛŒ:</label>
                        <form method="get" style="display: inline;">
                            @if (!string.IsNullOrWhiteSpace(Model.Filters.SearchTerm))
                            {
                                <input type="hidden" name="search" value="@Model.Filters.SearchTerm" />
                            }
                            @if (!string.IsNullOrWhiteSpace(Model.Filters.SelectedCategory))
                            {
                                <input type="hidden" name="category" value="@Model.Filters.SelectedCategory" />
                            }
                            <select name="sort" class="sort-select" onchange="this.form.submit()">
                                @foreach (var option in Model.Filters.SortOptions)
                                {
                                    <option value="@option.Value" selected="@option.IsSelected">@option.Label</option>
                                }
                            </select>
                        </form>
                    </div>
                </div>

                <!-- Products Grid -->
                @if (Model.Products.Any())
                {
                    <div class="archive-products-grid">
                        @foreach (var product in Model.Products)
                        {
                            <div class="archive-product-card">
                                @if (!string.IsNullOrWhiteSpace(product.Badge))
                                {
                                    <span class="product-badge">@product.Badge</span>
                                }
                                <a asp-controller="Product" asp-action="Details" asp-route-slug="@product.Slug" style="text-decoration: none; color: inherit;">
                                    <div class="archive-product-image">
                                        <img src="@product.ThumbnailUrl" alt="@product.Name" style="width: 100%; height: 100%; object-fit: cover;" />
                                    </div>
                                    <div class="archive-product-info">
                                        <h3 class="archive-product-name">@StringHelper.TruncateName(product.Name)</h3>
                                        <p class="archive-product-desc">@StringHelper.TruncateDescription(product.ShortDescription)</p>
                                        <div class="archive-product-rating">
                                            @for (int i = 0; i < (int)product.Rating; i++)
                                            {
                                                <span>â­</span>
                                            }
                                            @product.GetRatingLabel()
                                        </div>
                                        <div class="archive-product-price">@product.GetFormattedPrice() ØªÙˆÙ…Ø§Ù†</div>
                                        <span class="archive-product-btn">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª</span>
                                    </div>
                                </a>
                            </div>
                        }
                    </div>
                }
                else
                {
                    <div class="archive-empty">
                        <p>Ù…Ø­ØµÙˆÙ„ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</p>
                    </div>
                }
            </main>
        </div>
    </div>
</section>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchForm = document.getElementById('productFilterForm');
            const searchInput = document.getElementById('search-input');
            const searchSubmitBtn = document.getElementById('search-submit-btn');
            const priceFilterBtn = document.getElementById('price-filter-btn');
            
            // Handle search button click
            if (searchSubmitBtn && searchForm) {
                searchSubmitBtn.addEventListener('click', function() {
                    searchForm.submit();
                });
                
                // Handle Enter key in search input
                if (searchInput) {
                    searchInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            searchForm.submit();
                        }
                    });
                }
            }
            
            // Handle price filter button click
            if (priceFilterBtn && searchForm) {
                priceFilterBtn.addEventListener('click', function() {
                    searchForm.submit();
                });
            }
        });
    </script>
}

