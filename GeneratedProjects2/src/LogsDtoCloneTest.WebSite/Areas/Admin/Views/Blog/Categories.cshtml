@using LogsDtoCloneTest.WebSite.Areas.Admin.Models
@model BlogCategoriesViewModel
@{
    var categories = Model.Categories?.ToList() ?? new List<BlogCategoryTreeItemViewModel>();
    var flatCategories = new List<(BlogCategoryTreeItemViewModel Category, string? ParentName, int ChildrenCount, int DescendantCount)>();

    void FlattenCategory(BlogCategoryTreeItemViewModel category, string? parentName)
    {
        var children = category.Children?.ToList() ?? new List<BlogCategoryTreeItemViewModel>();
        flatCategories.Add((category, parentName, children.Count, category.DescendantIds?.Count ?? 0));

        foreach (var child in children)
        {
            FlattenCategory(child, category.Name);
        }
    }

    foreach (var rootCategory in categories)
    {
        FlattenCategory(rootCategory, null);
    }

    var totalCategories = flatCategories.Count;
    var rootCategories = flatCategories.Count(item => item.Category.Depth == 0);
    var branchCategories = flatCategories.Count(item => item.ChildrenCount > 0);
    var leafCategories = flatCategories.Count(item => item.ChildrenCount == 0);
    var maxDepth = flatCategories.Count == 0 ? 0 : flatCategories.Max(item => item.Category.Depth);

    var query = Context.Request.Query;
    var searchTerm = query["search"].ToString()?.Trim();
    var parentIdRaw = query["parentId"].ToString();
    var depthRaw = query["depth"].ToString();
    var structureRaw = query["structure"].ToString();
    var pageRaw = query["page"].ToString();
    var pageSizeRaw = query["pageSize"].ToString();

    Guid? parentFilter = Guid.TryParse(parentIdRaw, out var parentGuid) ? parentGuid : null;
    int? depthFilter = int.TryParse(depthRaw, out var parsedDepth) ? parsedDepth : null;

    var structureFilter = string.IsNullOrWhiteSpace(structureRaw) ? "any" : structureRaw;
    var hasFilters = !string.IsNullOrWhiteSpace(searchTerm) || parentFilter is not null || depthFilter is not null || structureFilter != "any";

    var pageSize = 8;
    if (int.TryParse(pageSizeRaw, out var parsedPageSize) && parsedPageSize >= 4 && parsedPageSize <= 24)
    {
        pageSize = parsedPageSize;
    }

    var pageNumber = 1;
    if (int.TryParse(pageRaw, out var parsedPage) && parsedPage > 0)
    {
        pageNumber = parsedPage;
    }

    IEnumerable<(BlogCategoryTreeItemViewModel Category, string? ParentName, int ChildrenCount, int DescendantCount)> FilterCategories(
        IEnumerable<(BlogCategoryTreeItemViewModel Category, string? ParentName, int ChildrenCount, int DescendantCount)> source)
    {
        if (!string.IsNullOrWhiteSpace(searchTerm))
        {
            source = source.Where(item =>
                (!string.IsNullOrWhiteSpace(item.Category.Name) && item.Category.Name.Contains(searchTerm, StringComparison.CurrentCultureIgnoreCase)) ||
                (!string.IsNullOrWhiteSpace(item.Category.Slug) && item.Category.Slug.Contains(searchTerm, StringComparison.CurrentCultureIgnoreCase)) ||
                (!string.IsNullOrWhiteSpace(item.Category.Description) && item.Category.Description.Contains(searchTerm, StringComparison.CurrentCultureIgnoreCase)));
        }

        if (parentFilter is not null)
        {
            source = source.Where(item => item.Category.Id == parentFilter || item.Category.ParentId == parentFilter);
        }

        if (depthFilter is not null)
        {
            source = source.Where(item => item.Category.Depth == depthFilter);
        }

        source = structureFilter switch
        {
            "withChildren" => source.Where(item => item.ChildrenCount > 0),
            "withoutChildren" => source.Where(item => item.ChildrenCount == 0),
            _ => source
        };

        return source;
    }

    var filteredCategories = FilterCategories(flatCategories).ToList();
    var filteredCount = filteredCategories.Count;

    var totalPages = filteredCount == 0 ? 1 : (int)Math.Ceiling(filteredCount / (double)pageSize);
    if (pageNumber > totalPages)
    {
        pageNumber = totalPages;
    }

    var pagedCategories = filteredCount == 0
        ? new List<(BlogCategoryTreeItemViewModel Category, string? ParentName, int ChildrenCount, int DescendantCount)>()
        : filteredCategories
            .Skip((pageNumber - 1) * pageSize)
            .Take(pageSize)
            .ToList();

    var firstItemIndex = filteredCount == 0 ? 0 : ((pageNumber - 1) * pageSize) + 1;
    var lastItemIndex = filteredCount == 0 ? 0 : firstItemIndex + pagedCategories.Count - 1;

    var pageSizeOptions = new[] { 6, 9, 12, 15, 18 };
    var searchRouteValue = string.IsNullOrWhiteSpace(searchTerm) ? null : searchTerm;
    var parentRouteValue = string.IsNullOrWhiteSpace(parentIdRaw) ? null : parentIdRaw;
    var depthRouteValue = string.IsNullOrWhiteSpace(depthRaw) ? null : depthRaw;
    var structureRouteValue = structureFilter == "any" ? null : structureFilter;
    var structureHiddenValue = structureFilter == "any" ? string.Empty : structureFilter;
    var parentHiddenValue = parentFilter is null ? string.Empty : parentFilter.Value.ToString();
    var depthHiddenValue = depthFilter is null ? string.Empty : depthFilter.Value.ToString();
}

@section Head {
    <link rel="stylesheet" href="~/css/admin/blog.css" asp-append-version="true" />
}

@section Breadcrumb {
    <li class="breadcrumb-item"><a asp-area="Admin" asp-controller="Dashboard" asp-action="Index">داشبورد</a></li>
    <li class="breadcrumb-item"><a asp-area="Admin" asp-controller="Blog" asp-action="Index">وبلاگ</a></li>
    <li class="breadcrumb-item active" aria-current="page">مدیریت دسته‌بندی‌ها</li>
}

@await Html.PartialAsync("_StatusMessage")

<div class="blog-categories-page">
    <div class="blog-categories-page__hero">
        <div>
            <h1 class="blog-categories-page__title">مدیریت دسته‌بندی‌های وبلاگ</h1>
            <p class="blog-categories-page__subtitle">پایش ساختار، فیلتر پیشرفته و مدیریت جزئیات دسته‌بندی‌ها</p>
        </div>
        <div class="blog-categories-page__actions">
            <a class="btn btn-outline-primary"
               asp-area="Admin"
               asp-controller="Blog"
               asp-action="Authors">
                <i class="bi bi-pen"></i>
                مدیریت نویسندگان
            </a>
            <button type="button"
                    class="btn btn-primary"
                    data-bs-toggle="modal"
                    data-bs-target="#createCategoryModal">
                <i class="bi bi-plus-lg me-1"></i>
                دسته‌بندی جدید
            </button>
        </div>
    </div>

    <div class="blog-category-overview">
        <div class="blog-category-overview__card blog-category-overview__card--primary">
            <div class="blog-category-overview__icon">
                <span class="badge bg-primary-subtle text-primary"><i class="bi bi-collection"></i></span>
            </div>
            <div class="blog-category-overview__content">
                <span class="blog-category-overview__label">کل دسته‌بندی‌ها</span>
                <span class="blog-category-overview__value">@totalCategories</span>
                <span class="blog-category-overview__hint">تمام سطوح سلسله‌مراتب</span>
            </div>
        </div>
        <div class="blog-category-overview__card blog-category-overview__card--info">
            <div class="blog-category-overview__icon">
                <span class="badge bg-info-subtle text-info"><i class="bi bi-diagram-3"></i></span>
            </div>
            <div class="blog-category-overview__content">
                <span class="blog-category-overview__label">دسته‌های سطح ۱</span>
                <span class="blog-category-overview__value">@rootCategories</span>
                <span class="blog-category-overview__hint">ریشه ساختار وبلاگ</span>
            </div>
        </div>
        <div class="blog-category-overview__card blog-category-overview__card--success">
            <div class="blog-category-overview__icon">
                <span class="badge bg-success-subtle text-success"><i class="bi bi-node-plus"></i></span>
            </div>
            <div class="blog-category-overview__content">
                <span class="blog-category-overview__label">دسته‌های دارای زیرمجموعه</span>
                <span class="blog-category-overview__value">@branchCategories</span>
                <span class="blog-category-overview__hint">شاخه‌های فعال در سلسله‌مراتب</span>
            </div>
        </div>
        <div class="blog-category-overview__card blog-category-overview__card--warning">
            <div class="blog-category-overview__icon">
                <span class="badge bg-warning-subtle text-warning"><i class="bi bi-dot"></i></span>
            </div>
            <div class="blog-category-overview__content">
                <span class="blog-category-overview__label">دسته‌های برگ</span>
                <span class="blog-category-overview__value">@leafCategories</span>
                <span class="blog-category-overview__hint">پایانی‌ترین گره‌های ساختار</span>
            </div>
        </div>
    </div>

    <div class="blog-category-toolbar card">
        <div class="card-body">
            <div class="blog-category-toolbar__row">
                <div class="blog-category-toolbar__summary">
                    <div class="blog-category-toolbar__count">@filteredCount دسته‌بندی</div>
                    @if (filteredCount > 0)
                    {
                        <div class="blog-category-toolbar__range">نمایش @firstItemIndex تا @lastItemIndex از @filteredCount نتیجه</div>
                    }
                    else
                    {
                        <div class="blog-category-toolbar__range">هیچ نتیجه‌ای مطابق فیلترهای فعلی یافت نشد</div>
                    }
                </div>
                <form class="blog-category-toolbar__search" method="get" asp-area="Admin" asp-controller="Blog" asp-action="Categories">
                    <input type="hidden" name="parentId" value="@parentHiddenValue" />
                    <input type="hidden" name="depth" value="@depthHiddenValue" />
                    <input type="hidden" name="structure" value="@structureHiddenValue" />
                    <input type="hidden" name="pageSize" value="@pageSize" />
                    <input type="hidden" name="page" value="1" />
                    <div class="input-group input-group-lg">
                        <span class="input-group-text"><i class="bi bi-search"></i></span>
                        <input type="search"
                               class="form-control"
                               name="search"
                               value="@searchTerm"
                               placeholder="جستجو در نام، مسیر یا توضیحات دسته‌بندی" />
                        @if (hasFilters || !string.IsNullOrWhiteSpace(searchTerm))
                        {
                            <a class="btn btn-light" asp-area="Admin" asp-controller="Blog" asp-action="Categories">
                                پاک‌سازی
                            </a>
                        }
                        <button class="btn btn-primary" type="submit">جستجو</button>
                    </div>
                </form>
                <div class="blog-category-toolbar__actions">
                    <button type="button"
                            class="btn btn-outline-secondary"
                            data-bs-toggle="modal"
                            data-bs-target="#categoryFilterModal">
                        <i class="bi bi-funnel me-1"></i>
                        فیلتر پیشرفته
                        @if (hasFilters)
                        {
                            <span class="badge rounded-pill text-bg-primary">@filteredCount</span>
                        }
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="blog-category-list card">
        <div class="card-body">
            @if (pagedCategories.Count == 0)
            {
                <div class="blog-category-empty">
                    <i class="bi bi-diagram-3"></i>
                    @if (totalCategories == 0 && !hasFilters && string.IsNullOrWhiteSpace(searchTerm))
                    {
                        <p>هنوز دسته‌بندی‌ای ثبت نشده است. اولین دسته‌بندی را اضافه کنید.</p>
                        <button type="button"
                                class="btn btn-primary"
                                data-bs-toggle="modal"
                                data-bs-target="#createCategoryModal">
                            <i class="bi bi-plus-lg me-1"></i>
                            افزودن دسته‌بندی جدید
                        </button>
                    }
                    else
                    {
                        <p>هیچ دسته‌بندی مطابق فیلترهای فعلی یافت نشد.</p>
                        <a class="btn btn-outline-secondary" asp-area="Admin" asp-controller="Blog" asp-action="Categories">بازنشانی فیلترها</a>
                    }
                </div>
            }
            else
            {
                <div class="table-responsive blog-category-table-wrapper">
                    <table class="table align-middle blog-category-table">
                        <thead>
                            <tr>
                                <th scope="col">عنوان</th>
                                <th scope="col">والد</th>
                                <th scope="col">سطح</th>
                                <th scope="col">زیرمجموعه مستقیم</th>
                                <th scope="col">کل زیرمجموعه</th>
                                <th scope="col" class="text-center">عملیات</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in pagedCategories)
                            {
                                var category = item.Category;
                                var descendants = category.DescendantIds is null ? string.Empty : string.Join('|', category.DescendantIds);
                                var depthBadge = category.Depth == 0 ? "ریشه" : $"سطح {category.Depth + 1}";
                                var parentLabel = string.IsNullOrWhiteSpace(item.ParentName) ? "بدون والد" : item.ParentName;
                                <tr data-category-node>
                                    <td>
                                        <div class="blog-category-table__title">@category.Name</div>
                                        <div class="blog-category-table__meta">
                                            <span class="blog-category-table__meta-item">
                                                <i class="bi bi-diagram-3"></i>
                                                @parentLabel
                                            </span>
                                            @if (!string.IsNullOrWhiteSpace(category.Slug))
                                            {
                                                <span class="blog-category-table__meta-item blog-category-table__meta-item--slug">
                                                    <i class="bi bi-link-45deg"></i>
                                                    @category.Slug
                                                </span>
                                            }
                                        </div>
                                        @if (!string.IsNullOrWhiteSpace(category.Description))
                                        {
                                            <div class="blog-category-table__description">@category.Description</div>
                                        }
                                    </td>
                                    <td>
                                        <span class="badge bg-light text-body border">@parentLabel</span>
                                    </td>
                                    <td>
                                        <span class="badge bg-primary-subtle text-primary">@depthBadge</span>
                                    </td>
                                    <td>
                                        <span class="blog-category-table__stat">@item.ChildrenCount</span>
                                    </td>
                                    <td>
                                        <span class="blog-category-table__stat">@item.DescendantCount</span>
                                    </td>
                                    <td class="text-center">
                                        <div class="btn-group blog-category-table__actions" role="group">
                                            <button type="button"
                                                    class="btn btn-light btn-icon"
                                                    title="افزودن زیرمجموعه"
                                                    data-bs-toggle="modal"
                                                    data-bs-target="#createCategoryModal"
                                                    data-category-parent-id="@category.Id"
                                                    data-category-parent-name="@category.Name">
                                                <i class="bi bi-node-plus"></i>
                                            </button>
                                            <button type="button"
                                                    class="btn btn-light btn-icon"
                                                    title="ویرایش"
                                                    data-bs-toggle="modal"
                                                    data-bs-target="#editCategoryModal"
                                                    data-category-id="@category.Id"
                                                    data-category-name="@category.Name"
                                                    data-category-slug="@(category.Slug ?? string.Empty)"
                                                    data-category-description="@(category.Description ?? string.Empty)"
                                                    data-category-parent-id="@(category.ParentId?.ToString() ?? string.Empty)"
                                                    data-category-descendants="@descendants">
                                                <i class="bi bi-pencil"></i>
                                            </button>
                                            <button type="button"
                                                    class="btn btn-light btn-icon text-danger"
                                                    title="حذف"
                                                    data-bs-toggle="modal"
                                                    data-bs-target="#deleteCategoryModal"
                                                    data-category-id="@category.Id"
                                                    data-category-name="@category.Name">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>

        @if (filteredCount > pageSize)
        {
            <div class="card-footer blog-category-pagination">
                <nav aria-label="صفحه‌بندی دسته‌بندی‌ها">
                    <ul class="pagination justify-content-center flex-wrap gap-2 mb-0">
                        <li class="page-item @(pageNumber == 1 ? "disabled" : string.Empty)">
                            <a class="page-link"
                               asp-area="Admin"
                               asp-controller="Blog"
                               asp-action="Categories"
                               asp-route-search="@searchRouteValue"
                               asp-route-parentId="@parentRouteValue"
                               asp-route-depth="@depthRouteValue"
                               asp-route-structure="@structureRouteValue"
                               asp-route-pageSize="@pageSize"
                               asp-route-page="@(pageNumber - 1)">
                                قبلی
                            </a>
                        </li>

                        @for (var i = 1; i <= totalPages; i++)
                        {
                            <li class="page-item @(i == pageNumber ? "active" : string.Empty)">
                                <a class="page-link"
                                   asp-area="Admin"
                                   asp-controller="Blog"
                                   asp-action="Categories"
                                   asp-route-search="@searchRouteValue"
                                   asp-route-parentId="@parentRouteValue"
                                   asp-route-depth="@depthRouteValue"
                                   asp-route-structure="@structureRouteValue"
                                   asp-route-pageSize="@pageSize"
                                   asp-route-page="@i">@i</a>
                            </li>
                        }

                        <li class="page-item @(pageNumber == totalPages ? "disabled" : string.Empty)">
                            <a class="page-link"
                               asp-area="Admin"
                               asp-controller="Blog"
                               asp-action="Categories"
                               asp-route-search="@searchRouteValue"
                               asp-route-parentId="@parentRouteValue"
                               asp-route-depth="@depthRouteValue"
                               asp-route-structure="@structureRouteValue"
                               asp-route-pageSize="@pageSize"
                               asp-route-page="@(pageNumber + 1)">
                                بعدی
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        }
    </div>
</div>

<div class="modal fade" id="categoryFilterModal" tabindex="-1" aria-labelledby="categoryFilterModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <form method="get" asp-area="Admin" asp-controller="Blog" asp-action="Categories">
                <input type="hidden" name="page" value="1" />
                <div class="modal-header">
                    <h5 class="modal-title" id="categoryFilterModalLabel">فیلتر پیشرفته دسته‌بندی‌ها</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="بستن"></button>
                </div>
                <div class="modal-body blog-category-filters">
                    <div class="row g-4">
                        <div class="col-12">
                            <label class="form-label" for="filterSearch">جستجو</label>
                            <input type="search"
                                   class="form-control"
                                   id="filterSearch"
                                   name="search"
                                   value="@searchTerm"
                                   placeholder="عبارت مورد نظر خود را وارد کنید" />
                        </div>
                        <div class="col-md-6">
                            <label class="form-label" for="filterParent">دسته‌بندی والد</label>
                            <select class="form-select" id="filterParent" name="parentId">
                                <option value="">همه والدها</option>
                                @foreach (var option in Model.ParentOptions)
                                {
                                    var selected = !string.IsNullOrWhiteSpace(parentIdRaw) && string.Equals(option.Value, parentIdRaw, StringComparison.OrdinalIgnoreCase);
                                    <option value="@option.Value" selected="@(selected ? "selected" : null)">@option.Text</option>
                                }
                            </select>
                            <div class="form-text">نمایش دسته‌بندی‌های زیرمجموعه یا والد مشخص</div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label" for="filterDepth">سطح دسته‌بندی</label>
                            <select class="form-select" id="filterDepth" name="depth">
                                <option value="">تمام سطوح</option>
                                @for (var depth = 0; depth <= maxDepth; depth++)
                                {
                                    var value = depth;
                                    var text = depth == 0 ? "سطح ۱ (ریشه)" : $"سطح {depth + 1}";
                                    var selected = depthFilter is not null && depthFilter.Value == depth;
                                    <option value="@value" selected="@(selected ? "selected" : null)">@text</option>
                                }
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label d-block">ساختار دسته‌بندی</label>
                            <div class="btn-group" role="group" aria-label="ساختار دسته‌بندی">
                                <input type="radio" class="btn-check" name="structure" id="structureAny" value="any" autocomplete="off" @(structureFilter == "any" ? "checked" : null)>
                                <label class="btn btn-outline-secondary" for="structureAny">همه</label>

                                <input type="radio" class="btn-check" name="structure" id="structureWithChildren" value="withChildren" autocomplete="off" @(structureFilter == "withChildren" ? "checked" : null)>
                                <label class="btn btn-outline-secondary" for="structureWithChildren">دارای زیرمجموعه</label>

                                <input type="radio" class="btn-check" name="structure" id="structureWithoutChildren" value="withoutChildren" autocomplete="off" @(structureFilter == "withoutChildren" ? "checked" : null)>
                                <label class="btn btn-outline-secondary" for="structureWithoutChildren">بدون زیرمجموعه</label>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label" for="filterPageSize">تعداد نمایش در هر صفحه</label>
                            <select class="form-select" id="filterPageSize" name="pageSize">
                                @foreach (var size in pageSizeOptions)
                                {
                                    var selected = pageSize == size;
                                    <option value="@size" selected="@(selected ? "selected" : null)">@size آیتم</option>
                                }
                            </select>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <a class="btn btn-light" asp-area="Admin" asp-controller="Blog" asp-action="Categories">حذف فیلترها</a>
                    <button type="submit" class="btn btn-primary">اعمال فیلتر</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="createCategoryModal" tabindex="-1" aria-labelledby="createCategoryModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" asp-area="Admin" asp-controller="Blog" asp-action="CreateCategory">
                @Html.AntiForgeryToken()
                <div class="modal-header">
                    <h5 class="modal-title" id="createCategoryModalLabel">افزودن دسته‌بندی</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="بستن"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label" for="createCategoryName">نام دسته‌بندی</label>
                        <input type="text" class="form-control" id="createCategoryName" name="Name" maxlength="200" required />
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="createCategorySlug">Slug</label>
                        <input type="text" class="form-control" id="createCategorySlug" name="Slug" maxlength="200" placeholder="اختیاری" />
                        <div class="form-text">در صورت خالی بودن، به‌صورت خودکار از نام ساخته می‌شود.</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="createCategoryParent">دسته‌بندی والد</label>
                        <select class="form-select" id="createCategoryParent" name="ParentId" data-category-parent-select>
                            @foreach (var option in Model.ParentOptions)
                            {
                                <option value="@option.Value" selected="@(option.Selected ? "selected" : null)">@option.Text</option>
                            }
                        </select>
                    </div>
                    <div class="mb-0">
                        <label class="form-label" for="createCategoryDescription">توضیحات</label>
                        <textarea class="form-control" id="createCategoryDescription" name="Description" maxlength="500" rows="3" placeholder="اختیاری"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">انصراف</button>
                    <button type="submit" class="btn btn-primary">افزودن دسته‌بندی</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="editCategoryModal" tabindex="-1" aria-labelledby="editCategoryModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" asp-area="Admin" asp-controller="Blog" asp-action="UpdateCategory">
                @Html.AntiForgeryToken()
                <input type="hidden" name="Id" value="" />
                <div class="modal-header">
                    <h5 class="modal-title" id="editCategoryModalLabel">ویرایش دسته‌بندی</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="بستن"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label" for="editCategoryName">نام دسته‌بندی</label>
                        <input type="text" class="form-control" id="editCategoryName" name="Name" maxlength="200" required />
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="editCategorySlug">Slug</label>
                        <input type="text" class="form-control" id="editCategorySlug" name="Slug" maxlength="200" placeholder="اختیاری" />
                        <div class="form-text">در صورت خالی بودن، مسیر براساس نام بروزرسانی می‌شود.</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="editCategoryParent">دسته‌بندی والد</label>
                        <select class="form-select" id="editCategoryParent" name="ParentId" data-category-parent-select>
                            @foreach (var option in Model.ParentOptions)
                            {
                                <option value="@option.Value" selected="@(option.Selected ? "selected" : null)">@option.Text</option>
                            }
                        </select>
                        <div class="form-text">انتخاب والد، سلسله‌مراتب دسته‌بندی را تعیین می‌کند.</div>
                    </div>
                    <div class="mb-0">
                        <label class="form-label" for="editCategoryDescription">توضیحات</label>
                        <textarea class="form-control" id="editCategoryDescription" name="Description" maxlength="500" rows="3" placeholder="اختیاری"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">انصراف</button>
                    <button type="submit" class="btn btn-primary">ذخیره تغییرات</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="deleteCategoryModal" tabindex="-1" aria-labelledby="deleteCategoryModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteCategoryModalLabel">حذف دسته‌بندی</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="بستن"></button>
            </div>
            <div class="modal-body">
                <p>آیا از حذف دسته‌بندی <strong data-category-delete-name></strong> مطمئن هستید؟</p>
                <p class="text-muted mb-0">در صورت وجود زیرمجموعه یا بلاگ فعال، ابتدا باید آن‌ها را منتقل کنید.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-light" data-bs-dismiss="modal">انصراف</button>
                <form method="post" asp-area="Admin" asp-controller="Blog" asp-action="DeleteCategory" data-category-delete-form>
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="id" value="" />
                    <button type="submit" class="btn btn-danger">بله، حذف شود</button>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/admin/blog-categories.js" asp-append-version="true"></script>
}
