@using TestAttarClone.WebSite.Areas.Admin.Models.Banners
@using TestAttarClone.SharedKernel.Extensions
@model BannerFormViewModel
@{
    var isEdit = Model.Id.HasValue;
    var formAction = isEdit ? "Edit" : "Create";
    ViewData["Title"] ??= isEdit ? "ویرایش بنر" : "افزودن بنر جدید";
    ViewData["Subtitle"] ??= isEdit ? "ویرایش اطلاعات بنر" : "ایجاد بنر جدید برای نمایش در سایت";
    
    // Format dates for display
    var startDateDisplay = Model.StartDate?.ToPersianDateString() ?? string.Empty;
    var startDateInit = string.IsNullOrWhiteSpace(Model.StartDatePersian) 
        ? string.Empty 
        : Model.StartDatePersian.Replace("-", "/");
    
    var endDateDisplay = Model.EndDate?.ToPersianDateString() ?? string.Empty;
    var endDateInit = string.IsNullOrWhiteSpace(Model.EndDatePersian) 
        ? string.Empty 
        : Model.EndDatePersian.Replace("-", "/");
}

@section Head {
    <link rel="stylesheet" href="~/css/admin/catalog.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/admin/blog-form.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/Plugins/JalaliDatePicker/css/jalalidatepicker.min.css" asp-append-version="true" />
}

@section Breadcrumb {
    <li class="breadcrumb-item"><a asp-area="Admin" asp-controller="Dashboard" asp-action="Index">داشبورد</a></li>
    <li class="breadcrumb-item"><a asp-area="Admin" asp-controller="Banners" asp-action="Index">بنرها</a></li>
    <li class="breadcrumb-item active" aria-current="page">@ViewData["Title"]</li>
}

@await Html.PartialAsync("_StatusMessage")

<div class="banner-form">
    <div class="card shadow-sm border-0">
        <div class="card-header bg-white">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h4 mb-1">@ViewData["Title"]</h1>
                    <p class="text-muted mb-0">@ViewData["Subtitle"]</p>
                </div>
                <div>
                    <a asp-area="Admin" asp-controller="Banners" asp-action="Index" class="btn btn-outline-secondary">
                        <i class="bi bi-arrow-right"></i>
                        بازگشت
                    </a>
                </div>
            </div>
        </div>
        <div class="card-body">
            <form asp-action="@formAction" asp-route-id="@(isEdit ? Model.Id : null)" method="post" enctype="multipart/form-data" novalidate data-banner-form>
                @Html.AntiForgeryToken()
                @if (isEdit)
                {
                    <input type="hidden" asp-for="Id" />
                }
                
                <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

                <div class="row g-4">
                    <div class="col-lg-8">
                        <div class="mb-3">
                            <label asp-for="Title" class="form-label">عنوان <span class="text-danger">*</span></label>
                            <input asp-for="Title" class="form-control" placeholder="عنوان بنر" />
                            <span asp-validation-for="Title" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="Image" class="form-label">تصویر <span class="text-danger">*</span></label>
                            <div class="featured-upload" data-banner-image-uploader>
                                <div class="featured-upload__preview @(string.IsNullOrWhiteSpace(Model.ImagePath) ? "featured-upload__preview--empty" : string.Empty)"
                                     data-banner-image-preview
                                     style="@(string.IsNullOrWhiteSpace(Model.ImagePath) ? string.Empty : $"background-image: url('{Url.Content(Model.ImagePath)}')")">
                                    <span class="featured-upload__placeholder" data-banner-image-placeholder>
                                        <i class="bi bi-image"></i>
                                        <span>تصویر بنر را انتخاب کنید</span>
                                    </span>
                                </div>
                                <div class="featured-upload__controls">
                                    <label class="btn btn-outline-secondary featured-upload__button">
                                        <i class="bi bi-upload"></i>
                                        انتخاب تصویر
                                        <input asp-for="Image" class="d-none" accept="image/*" data-banner-image-input />
                                    </label>
                                    <div class="featured-upload__meta">
                                        <span data-banner-image-filename>
                                            @(string.IsNullOrWhiteSpace(Model.ImagePath) ? "تصویر انتخاب نشده است" : "تصویر فعلی انتخاب شده")
                                        </span>
                                        @if (isEdit && !string.IsNullOrWhiteSpace(Model.ImagePath))
                                        {
                                            <div class="form-check form-switch mt-2">
                                                <input asp-for="RemoveImage" class="form-check-input" data-banner-image-remove />
                                                <label class="form-check-label" asp-for="RemoveImage">حذف تصویر</label>
                                            </div>
                                        }
                                    </div>
                                </div>
                            </div>
                            <input asp-for="ImagePath" type="hidden" data-banner-image-path />
                            <span asp-validation-for="Image" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="LinkUrl" class="form-label">لینک</label>
                            <input asp-for="LinkUrl" class="form-control text-start" dir="ltr" placeholder="https://example.com" />
                            <span asp-validation-for="LinkUrl" class="text-danger"></span>
                        </div>

                        <div class="mb-3">
                            <label asp-for="AltText" class="form-label">متن جایگزین (Alt Text)</label>
                            <input asp-for="AltText" class="form-control" placeholder="متن جایگزین برای تصویر" />
                            <span asp-validation-for="AltText" class="text-danger"></span>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label asp-for="DisplayOrder" class="form-label">ترتیب نمایش</label>
                                <input asp-for="DisplayOrder" class="form-control" type="number" min="0" />
                                <span asp-validation-for="DisplayOrder" class="text-danger"></span>
                            </div>
                            <div class="col-md-6 mb-3" data-banner-date>
                                <label asp-for="StartDatePersian" class="form-label">تاریخ شروع</label>
                                <div class="jalali-picker" data-jalali-picker>
                                    <div class="jalali-picker__controls">
                                        <input type="text"
                                               class="form-control"
                                               placeholder="انتخاب تاریخ"
                                               value="@startDateDisplay"
                                               data-jalali-input
                                               data-jdp
                                               data-jdp-only-date
                                               data-jdp-init-date="@startDateInit"
                                               autocomplete="off"
                                               dir="ltr" />
                                    </div>
                                    <input asp-for="StartDatePersian" type="hidden" data-jalali-target />
                                </div>
                                <span asp-validation-for="StartDatePersian" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3" data-banner-date>
                                <label asp-for="EndDatePersian" class="form-label">تاریخ پایان</label>
                                <div class="jalali-picker" data-jalali-picker>
                                    <div class="jalali-picker__controls">
                                        <input type="text"
                                               class="form-control"
                                               placeholder="انتخاب تاریخ"
                                               value="@endDateDisplay"
                                               data-jalali-input
                                               data-jdp
                                               data-jdp-only-date
                                               data-jdp-init-date="@endDateInit"
                                               autocomplete="off"
                                               dir="ltr" />
                                    </div>
                                    <input asp-for="EndDatePersian" type="hidden" data-jalali-target />
                                </div>
                                <span asp-validation-for="EndDatePersian" class="text-danger"></span>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4">
                        <div class="card bg-light">
                            <div class="card-body">
                                <h5 class="card-title mb-3">تنظیمات</h5>
                                
                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" asp-for="IsActive" />
                                        <label class="form-check-label" asp-for="IsActive">فعال</label>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" asp-for="ShowOnHomePage" />
                                        <label class="form-check-label" asp-for="ShowOnHomePage">نمایش در صفحه اصلی</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-4 d-flex justify-content-between">
                    <a asp-area="Admin" asp-controller="Banners" asp-action="Index" class="btn btn-outline-secondary">
                        <i class="bi bi-x-circle"></i>
                        انصراف
                    </a>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-check-circle"></i>
                        ذخیره
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/Plugins/JalaliDatePicker/js/jalalidatepicker.min.js"></script>
    <script src="~/js/admin/banner-form.js" asp-append-version="true"></script>
}

