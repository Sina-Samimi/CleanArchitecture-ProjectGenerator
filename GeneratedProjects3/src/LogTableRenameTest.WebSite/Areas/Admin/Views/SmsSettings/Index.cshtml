@model SmsSettingsViewModel
@{
    ViewData["Title"] ??= "تنظیمات پنل پیامکی";
    ViewData["Subtitle"] ??= "مدیریت تنظیمات سرویس پیامک";
}

@section Breadcrumb {
    <li class="breadcrumb-item"><a asp-area="Admin" asp-controller="Dashboard" asp-action="Index">داشبورد</a></li>
    <li class="breadcrumb-item active" aria-current="page">@ViewData["Title"]</li>
}

@await Html.PartialAsync("_StatusMessage")

<div class="row g-4 align-items-stretch">
    <div class="col-12 col-xl-8">
        <form asp-area="Admin" asp-controller="SmsSettings" asp-action="Index" method="post" class="card h-100" novalidate>
            <div class="card-header d-flex justify-content-between align-items-center">
                <div>
                    <h2 class="card-title h4 mb-1">تنظیمات پنل پیامکی</h2>
                    <p class="card-subtitle text-muted mb-0">تنظیمات مربوط به سرویس ارسال پیامک کاوه‌نگار را در این بخش مدیریت کنید.</p>
                </div>
                <span class="badge bg-light text-primary">تنظیمات امنیتی</span>
            </div>
            <div class="card-body">
                @Html.AntiForgeryToken()
                <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

                <div class="row g-4">
                    <div class="col-12">
                        <div class="alert alert-info" role="alert">
                            <i class="bi bi-info-circle me-2"></i>
                            <strong>نکته امنیتی:</strong> API Key شما به صورت امن در دیتابیس ذخیره می‌شود و در فایل‌های تنظیمات قرار نمی‌گیرد.
                        </div>
                    </div>

                    <div class="col-12">
                        <label asp-for="ApiKey" class="form-label"></label>
                        <input asp-for="ApiKey" class="form-control" type="password" autocomplete="off" />
                        <span class="form-text text-muted">API Key دریافتی از پنل کاوه‌نگار. این فیلد به صورت رمزنگاری شده ذخیره می‌شود.</span>
                        <span asp-validation-for="ApiKey" class="text-danger"></span>
                    </div>

                    <div class="col-12">
                        <div class="form-check form-switch">
                            <input asp-for="IsActive" class="form-check-input" type="checkbox" id="isActiveSwitch" />
                            <label class="form-check-label" for="isActiveSwitch">
                                <strong>@Html.DisplayNameFor(m => m.IsActive)</strong>
                            </label>
                            <div class="form-text text-muted">در صورت غیرفعال بودن، هیچ پیامکی ارسال نخواهد شد.</div>
                        </div>
                    </div>

                </div>
            </div>
            <div class="card-footer d-flex justify-content-end gap-2">
                <button type="submit" class="btn btn-primary">
                    <i class="bi bi-save me-2"></i>
                    ذخیره تنظیمات
                </button>
            </div>
        </form>
    </div>
    <div class="col-12 col-xl-4">
        <div class="card h-100">
            <div class="card-header">
                <h3 class="card-title h5 mb-0">راهنمای استفاده</h3>
            </div>
            <div class="card-body">
                <div class="mb-4">
                    <h6 class="fw-bold mb-2">مراحل دریافت API Key:</h6>
                    <ol class="mb-0">
                        <li>وارد پنل کاوه‌نگار شوید</li>
                        <li>به بخش API Key بروید</li>
                        <li>API Key خود را کپی کنید</li>
                        <li>در فیلد بالا وارد کنید</li>
                    </ol>
                </div>
                <div class="mb-4">
                    <h6 class="fw-bold mb-2">نکات مهم:</h6>
                    <ul class="mb-0">
                        <li>API Key را به هیچ کس ندهید</li>
                        <li>در صورت افشا شدن، سریعاً آن را تغییر دهید</li>
                        <li>از قالب‌های تعریف شده در پنل استفاده کنید</li>
                    </ul>
                </div>
                <div class="alert alert-warning mb-0" role="alert">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    <strong>توجه:</strong> پس از ذخیره تنظیمات، سرویس پیامک به‌صورت خودکار از این تنظیمات استفاده خواهد کرد.
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Toggle password visibility for API Key
        document.addEventListener('DOMContentLoaded', function() {
            const apiKeyInput = document.querySelector('input[name="ApiKey"]');
            if (apiKeyInput) {
                // Add a button to toggle visibility
                const wrapper = document.createElement('div');
                wrapper.className = 'input-group';
                apiKeyInput.parentNode.insertBefore(wrapper, apiKeyInput);
                wrapper.appendChild(apiKeyInput);
                
                const toggleBtn = document.createElement('button');
                toggleBtn.className = 'btn btn-outline-secondary';
                toggleBtn.type = 'button';
                toggleBtn.innerHTML = '<i class="bi bi-eye"></i>';
                toggleBtn.onclick = function() {
                    if (apiKeyInput.type === 'password') {
                        apiKeyInput.type = 'text';
                        toggleBtn.innerHTML = '<i class="bi bi-eye-slash"></i>';
                    } else {
                        apiKeyInput.type = 'password';
                        toggleBtn.innerHTML = '<i class="bi bi-eye"></i>';
                    }
                };
                wrapper.appendChild(toggleBtn);
            }
        });
    </script>
}
